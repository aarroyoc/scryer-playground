<!DOCTYPE html>
<html>
<head>
    <title>Scryer Test</title>
</head>
<body>
    <h1>Scryer.js Test</h1>
    <div id="output"></div>
    <script type="module">
        const output = document.getElementById('output');

        try {
            output.innerHTML += "Loading scryer...<br>";
            const { init, Prolog } = await import("https://esm.sh/scryer@0.7.0");
            output.innerHTML += "Imported successfully<br>";

            await init();
            output.innerHTML += "Initialized<br>";

            const pl = new Prolog();
            output.innerHTML += "Prolog instance created<br>";

            // Try a simple query first
            try {
                const q1 = pl.query("X = 1.");
                output.innerHTML += "Simple query created<br>";
                for (const answer of q1) {
                    output.innerHTML += `Answer: ${JSON.stringify(answer.bindings)}<br>`;
                }
            } catch (e) {
                output.innerHTML += `Simple query error: ${e}<br>`;
            }

            // Try loading lists library and using length
            try {
                pl.consultText(":- use_module(library(lists)).");
                output.innerHTML += "Lists library loaded<br>";

                const q2 = pl.query("length(Ls, N).");
                output.innerHTML += "Length query created<br>";

                let count = 0;
                for (const answer of q2) {
                    output.innerHTML += `Answer ${count}: ${JSON.stringify(answer.bindings)}<br>`;
                    count++;
                    if (count >= 3) {
                        q2.return(true);
                        break;
                    }
                }
            } catch (e) {
                output.innerHTML += `Length query error: ${e}<br>`;
            }

        } catch (e) {
            output.innerHTML += `Error: ${e}<br>`;
            output.innerHTML += `Stack: ${e.stack}<br>`;
        }
    </script>
</body>
</html>
